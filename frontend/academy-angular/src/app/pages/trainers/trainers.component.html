<section class="relative isolate overflow-hidden" [dir]="isRtl ? 'rtl' : 'ltr'">
  <div class="absolute inset-0 -z-10 animated-gradient opacity-90"></div>
  <div class="absolute inset-0 z-0 bg-black/55"></div>
  <div class="absolute -top-20 -left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl hidden md:block"></div>
  <div class="absolute -bottom-24 -right-24 w-80 h-80 bg-black/10 rounded-full blur-3xl hidden md:block"></div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-14 md:py-20 lg:py-28 relative z-10">
    <div class="text-center mb-16 animate-fade-in-up">
      <div class="max-w-4xl mx-auto">
        <h1 class="text-4xl lg:text-6xl font-bold text-white mb-6 leading-tight">{{ isRtl ? 'المدربون' : 'Trainers' }}</h1>
        <p class="text-xl text-white/90 max-w-3xl mx-auto">{{ isRtl ? 'تعرف على جميع مدربينا المحترفين' : 'Meet all our professional trainers' }}</p>
        <div *ngIf="isAdmin" class="mt-4">
          <button (click)="openAddModal()" class="rounded-full academy-button inline-flex items-center gap-3 px-8 py-4 text-lg font-semibold shadow-2xl hover:shadow-3xl transition-all duration-300 transform hover:scale-105">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
            <span>{{ 'add_trainer' | t }}</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Training Type Categories -->
    <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-16">
      <div *ngFor="let category of trainingTypeCategories"
           class="bg-white/10 backdrop-blur-sm border border-white/20 rounded-2xl p-6 text-center cursor-pointer hover:bg-white/20 transition-all duration-300"
           [ngClass]="{ 'ring-2': selectedCategory === category.id, 'ring-white/30': selectedCategory === category.id }"
           (click)="selectTrainingTypeCategory(category.id)">
        <div class="w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center" [ngClass]="category.color">
          <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-white mb-2">
          {{ isRtl ? category.nameAr : category.nameEn }}
        </h3>
        <p class="text-white/70 text-sm mb-3">
          {{ isRtl ? 'وصف مختصر للفئة' : 'Short description for the category' }}
        </p>
        <div class="inline-block bg-white/20 text-white px-3 py-1 rounded-full text-sm">
          {{ category.count }} {{ isRtl ? 'مدرب' : 'trainers' }}
        </div>
      </div>
    </div>

    <!-- Search -->
    <div class="bg-white/10 backdrop-blur-sm border border-white/20 rounded-2xl p-6 mb-12">
      <div class="flex flex-col md:flex-row gap-4">
        <div class="flex-1 relative">
          <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-white/50 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          <input type="text" [placeholder]="isRtl ? 'ابحث عن مدرب...' : 'Search for a trainer...'" [(ngModel)]="searchQuery" class="w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/30" />
        </div>
        <button (click)="selectedCategory='all'" class="bg-white/20 hover:bg-white/30 text-white border border-white/30 px-6 py-3 rounded-lg font-medium transition-all duration-300 hover:scale-105">
          {{ isRtl ? 'عرض الكل' : 'Show All' }}
        </button>
        <button (click)="searchQuery=''" class="bg-white/20 hover:bg-white/30 text-white border border-white/30 px-6 py-3 rounded-lg font-medium transition-all duration-300 hover:scale-105">
          {{ isRtl ? 'مسح' : 'Clear' }}
        </button>
      </div>
    </div>

    <div *ngIf="loading" class="text-center py-20">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"></div>
      <p class="text-white/90">{{ 'loading_plain' | t }}</p>
    </div>
    <div *ngIf="error" class="text-center py-20 text-white">{{ error }}</div>

    <div *ngIf="!loading && !error">
      <ng-container *ngIf="filteredTrainers.length > 0; else noTrainers">
        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 gap-6">
          <div *ngFor="let trainer of filteredTrainers" class="bg-white/10 backdrop-blur-sm border border-white/20 rounded-2xl p-6 hover:bg-white/15 transition-all duration-300 flex flex-col h-full">
            <div class="flex items-center gap-4 mb-4">
              <div class="w-16 h-16 rounded-full bg-white/20 flex items-center justify-center overflow-hidden ring-2 ring-white/20">
                <ng-container *ngIf="trainer.image; else defaultAvatar">
                  <img [src]="trainer.image" [alt]="trainer.name" class="w-full h-full object-cover" />
                </ng-container>
                <ng-template #defaultAvatar>
                  <svg class="w-9 h-9 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H7a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                  </svg>
                </ng-template>
              </div>
              <div class="flex-1 min-w-0">
                <h3 class="text-xl font-bold text-white truncate">{{ trainer.name }}</h3>
                <div class="flex items-center gap-2 mb-2">
                  <span class="inline-block px-2 py-1 rounded-full text-xs font-medium text-white" 
                        [ngClass]="{
                          'bg-purple-500/20': getTrainerTrainingType(trainer) === 'softSkills',
                          'bg-blue-500/20': getTrainerTrainingType(trainer) === 'technical',
                          'bg-green-500/20': getTrainerTrainingType(trainer) === 'freelancer',
                          'bg-orange-500/20': getTrainerTrainingType(trainer) === 'english'
                        }">
                    {{ isRtl ? 
                        (getTrainerTrainingType(trainer) === 'softSkills' ? 'المهارات الناعمة' :
                         getTrainerTrainingType(trainer) === 'technical' ? 'تقني' :
                         getTrainerTrainingType(trainer) === 'freelancer' ? 'مستقل' :
                         getTrainerTrainingType(trainer) === 'english' ? 'إنجليزي' : '') :
                        (getTrainerTrainingType(trainer) === 'softSkills' ? 'Soft Skills' :
                         getTrainerTrainingType(trainer) === 'technical' ? 'Technical' :
                         getTrainerTrainingType(trainer) === 'freelancer' ? 'Freelancer' :
                         getTrainerTrainingType(trainer) === 'english' ? 'English' : '')
                    }}
                  </span>
                </div>
                <p class="text-white/60 text-sm truncate-2-lines">{{ trainer.description }}</p>
              </div>
            </div>

            <div class="border-t border-white/10 mt-4 pt-4"></div>
            <div class="flex flex-wrap gap-2 mb-6">
              <a *ngIf="trainer.email" [href]="'mailto:'+trainer.email" class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 text-white/90 text-xs border border-white/20 hover:bg-white/20 transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4h16v16H4zM22 6l-10 7L2 6"/></svg>
                <span class="break-all">{{ trainer.email }}</span>
              </a>
              <a *ngIf="trainer.phone" [href]="'tel:'+trainer.phone" class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 text-white/90 text-xs border border-white/20 hover:bg-white/20 transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22 16.92v2a2 2 0 0 1-2.18 2 19.86 19.86 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6A19.86 19.86 0 0 1 2.11 3.18 2 2 0 0 1 4.11 1h2a2 2 0 0 1 2 1.72c.12.89.37 1.76.73 2.58a2 2 0 0 1-.45 2.11L7.09 8.91a16 16 0 0 0 6 6l1.5-1.3a2 2 0 0 1 2.11-.45 12.31 12.31 0 0 0 2.58.73A2 2 0 0 1 22 16.92z"/></svg>
                <span>{{ trainer.phone }}</span>
              </a>
            </div>

            <div class="mt-auto pt-4 border-t border-white/10 flex items-center justify-between gap-3">
              <ng-container *ngIf="isAdmin">
                <div class="flex items-center gap-2">
                  <button (click)="$event.stopPropagation(); openTrainer(trainer.id)" class="text-white/80 hover:text-white bg-white/10 hover:bg-white/20 border border-white/20 w-9 h-9 rounded-full inline-flex items-center justify-center transition-all" title="{{ isRtl ? 'عرض' : 'View' }}">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="10"/><path d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/></svg>
                  </button>
                  <button (click)="$event.stopPropagation(); editTrainer(trainer.id)" class="text-white/80 hover:text-white bg-green-600/80 hover:bg-green-600 w-9 h-9 rounded-full inline-flex items-center justify-center transition-all" title="{{ isRtl ? 'تعديل' : 'Edit' }}">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 1 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg>
                  </button>
                  <button (click)="$event.stopPropagation(); openDeleteDialog(trainer)" class="text-white bg-red-600/80 hover:bg-red-600 w-9 h-9 rounded-full inline-flex items-center justify-center transition-all" title="{{ isRtl ? 'حذف' : 'Delete' }}">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"/></svg>
                  </button>
                </div>
              </ng-container>
              <button (click)="openTrainer(trainer.id)" class="bg-white/20 hover:bg-white/30 text-white border border-white/30 px-4 py-2 rounded-full font-semibold transition-all duration-300 inline-flex items-center gap-2">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="12" cy="12" r="10"/><path d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/></svg>
                {{ isRtl ? 'عرض' : 'View' }}
              </button>
            </div>
          </div>
        </div>
      </ng-container>

      <ng-template #noTrainers>
        <div class="text-center py-12">
          <svg class="w-16 h-16 text-white/50 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 12l9 4-9 4-9-4 9-4z"></path></svg>
          <p class="text-white/70 text-lg">{{ isRtl ? 'لا يوجد مدربون' : 'No trainers available' }}</p>
        </div>
      </ng-template>
    </div>

    <div *ngIf="!loading && !error && trainers.length === 0" class="text-center py-20">
      <p class="text-white/90 text-lg">{{ 'no_data' | t }}</p>
    </div>
  </div>

  <!-- Add Trainer Modal -->
  <div *ngIf="isAddOpen" class="fixed inset-0 z-50">
    <div class="absolute inset-0 bg-black/50" (click)="isAddOpen=false"></div>
    <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 max-w-3xl w-full max-h-[90vh] overflow-y-auto bg-white/95 backdrop-blur-md rounded-2xl border border-white/30 shadow-2xl p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold">{{ 'add_trainer' | t }}</h3>
        <button class="rounded-full" (click)="isAddOpen=false">✕</button>
      </div>

      <!-- Category selector -->
      <div class="mb-4">
        <label class="block text-sm font-medium mb-1">{{ 'training_type' | t }}</label>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
          <button type="button" (click)="selectedAddCategory='softSkill'" [class]="selectedAddCategory==='softSkill' ? 'border-blue-500 bg-blue-500 text-white shadow-md rounded-lg p-2 text-sm' : 'border rounded-lg p-2 text-sm border-gray-300 hover:border-blue-400 hover:bg-blue-50 text-gray-700'">Soft Skills</button>
          <button type="button" (click)="selectedAddCategory='technical'" [class]="selectedAddCategory==='technical' ? 'border-blue-500 bg-blue-500 text-white shadow-md rounded-lg p-2 text-sm' : 'border rounded-lg p-2 text-sm border-gray-300 hover:border-blue-400 hover:bg-blue-50 text-gray-700'">Technical</button>
          <button type="button" (click)="selectedAddCategory='freelancer'" [class]="selectedAddCategory==='freelancer' ? 'border-blue-500 bg-blue-500 text-white shadow-md rounded-lg p-2 text-sm' : 'border rounded-lg p-2 text-sm border-gray-300 hover:border-blue-400 hover:bg-blue-50 text-gray-700'">Freelancer</button>
          <button type="button" (click)="selectedAddCategory='english'" [class]="selectedAddCategory==='english' ? 'border-blue-500 bg-blue-500 text-white shadow-md rounded-lg p-2 text-sm' : 'border rounded-lg p-2 text-sm border-gray-300 hover:border-blue-400 hover:bg-blue-50 text-gray-700'">English</button>
        </div>
      </div>

      <!-- Tabs -->
      <div class="flex items-center gap-2 mb-4">
        <button type="button" (click)="activeAddTab='basic'" [class]="activeAddTab==='basic' ? 'px-3 py-1.5 rounded-full text-sm border border-blue-500 text-blue-500 bg-blue-50 shadow-md' : 'px-3 py-1.5 rounded-full text-sm border border-gray-300 hover:border-blue-400 hover:bg-blue-50 text-gray-700'">{{ 'basic' | t }}</button>
        <button type="button" (click)="activeAddTab='cv'" [class]="activeAddTab==='cv' ? 'px-3 py-1.5 rounded-full text-sm border border-blue-500 text-blue-500 bg-blue-50 shadow-md' : 'px-3 py-1.5 rounded-full text-sm border border-gray-300 hover:border-blue-400 hover:bg-blue-50 text-gray-700'">CV</button>
        <button type="button" (click)="activeAddTab='video'" [class]="activeAddTab==='video' ? 'px-3 py-1.5 rounded-full text-sm border border-blue-500 text-blue-500 bg-blue-50 shadow-md' : 'px-3 py-1.5 rounded-full text-sm border border-gray-300 hover:border-blue-400 hover:bg-blue-50 text-gray-700'">{{ 'video' | t }}</button>
      </div>

      <!-- Content -->
      <form *ngIf="activeAddTab==='basic'" (submit)="handleCreateTrainer($event)" class="grid gap-3">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <input class="px-3 py-2 rounded border" [placeholder]="'trainer_name_ar_req' | t" [(ngModel)]="form.TeacherNameL1" name="TeacherNameL1" minlength="3" maxlength="70" required />
          <input class="px-3 py-2 rounded border" [placeholder]="'trainer_name_en' | t" [(ngModel)]="form.TeacherNameL2" name="TeacherNameL2" minlength="3" maxlength="70" />
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <input class="px-3 py-2 rounded border" [placeholder]="'address_req' | t" [(ngModel)]="form.TeacherAddress" name="TeacherAddress" required />
          <input class="px-3 py-2 rounded border" [placeholder]="'nid_14_req' | t" [(ngModel)]="form.NationalId" name="NationalId" inputmode="numeric" pattern="\d{14}" />
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <input class="px-3 py-2 rounded border" [placeholder]="'mobile' | t" [(ngModel)]="form.TeacherMobile" name="TeacherMobile" />
          <input class="px-3 py-2 rounded border" [placeholder]="'phone' | t" [(ngModel)]="form.TeacherPhone" name="TeacherPhone" />
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <input class="px-3 py-2 rounded border" [placeholder]="'whatsapp_req' | t" [(ngModel)]="form.TeacherWhatsapp" name="TeacherWhatsapp" required />
          <input type="email" class="px-3 py-2 rounded border" [placeholder]="'email_req' | t" [(ngModel)]="form.TeacherEmail" name="TeacherEmail" required />
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div class="relative">
            <select class="px-3 py-2 rounded border w-full" [(ngModel)]="form.AcademyDataId" name="AcademyDataId" [disabled]="loadingAcademies" required>
              <option value="">{{ 'select_academy' | t }}</option>
              <option *ngFor="let a of academies" [value]="a.id">{{ a.academyNameL1 || a.AcademyNameL1 || a.academyNameL2 || a.AcademyNameL2 || a.name || a.id }}</option>
            </select>
          </div>
          <select class="px-3 py-2 rounded border" [(ngModel)]="form.BranchesDataId" name="BranchesDataId" [disabled]="loadingAcademies">
            <option value="">{{ 'select_branch_opt' | t }}</option>
            <option *ngFor="let b of branches" [value]="b.id">{{ b.branchNameL1 || b.BranchNameL1 || b.branchNameL2 || b.BranchNameL2 || b.name || b.id }}</option>
          </select>
        </div>
        <textarea class="px-3 py-2 rounded border min-h-20" [placeholder]="'description_opt' | t" [(ngModel)]="form.Description" name="Description"></textarea>
        <div class="flex items-center gap-2">
          <input type="file" accept="image/*" (change)="onImageChange($event)" />
        </div>
        <div class="flex justify-between">
          <div></div>
          <button type="submit" class="rounded-full academy-button px-5 py-2">{{ 'next' | t }}</button>
        </div>
      </form>

      <form *ngIf="activeAddTab==='cv'" (submit)="handleUploadCv($event)" class="grid gap-3">
        <div class="grid grid-cols-1 gap-3">
          <input class="px-3 py-2 rounded border" [placeholder]="'cv_url_opt' | t" [(ngModel)]="cvUrlInput" name="cvUrlInput" />
        </div>
        <div class="flex justify-between">
          <button type="button" class="px-4 py-2 border rounded-full" (click)="activeAddTab='basic'">{{ 'back' | t }}</button>
          <button type="submit" class="rounded-full academy-button px-5 py-2">{{ 'next' | t }}</button>
        </div>
      </form>

      <form *ngIf="activeAddTab==='video'" (submit)="handleSaveVideo($event)" class="grid gap-3">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <input class="px-3 py-2 rounded border" [placeholder]="'video_url_opt' | t" [(ngModel)]="videoUrl" name="videoUrl" />
        </div>
        <div class="flex justify-between">
          <button type="button" class="px-4 py-2 border rounded-full" (click)="activeAddTab='cv'">{{ 'back' | t }}</button>
          <button type="submit" [disabled]="savingVideo" class="rounded-full academy-button px-5 py-2">{{ savingVideo ? ('adding' | t) : ('add_trainer' | t) }}</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Dialog -->
  <div *ngIf="showDeleteDialog" class="fixed inset-0 z-50">
    <div class="absolute inset-0 bg-black/60" (click)="showDeleteDialog=false"></div>
    <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[95vw] max-w-md bg-white rounded-xl shadow-xl p-5">
      <h3 class="text-lg font-semibold mb-2">{{ 'confirm_delete' | t }}</h3>
      <p class="text-sm mb-4">{{ 'are_you_sure_delete' | t }} {{ trainerToDelete?.name }}</p>
      <div class="flex justify-end gap-2">
        <button class="px-4 py-2 border rounded" (click)="showDeleteDialog=false">{{ 'cancel' | t }}</button>
        <button class="px-4 py-2 bg-red-600 text-white rounded" (click)="confirmDelete()">{{ 'delete' | t }}</button>
      </div>
    </div>
  </div>
</section>

