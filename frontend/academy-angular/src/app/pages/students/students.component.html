<div class="relative isolate overflow-hidden" [dir]="isRtl ? 'rtl' : 'ltr'">
  <div class="absolute inset-0 -z-10 animated-gradient opacity-90"></div>
  <div class="absolute inset-0 z-0 bg-black/55"></div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-14 md:py-20 lg:py-28 relative z-10">
    <div class="flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between mb-6">
      <h1 class="text-3xl sm:text-4xl font-extrabold text-white">{{ isRtl ? 'الطلاب' : 'Students' }}</h1>
      <div class="flex items-center gap-2">
        <a routerLink="/students/data" class="rounded-full academy-button px-4 py-2">{{ isRtl ? 'إضافة طالب' : 'Add Student' }}</a>
        <a routerLink="/students/attendance" class="rounded-full bg-transparent border border-white/30 text-white hover:bg-white/10 px-4 py-2">{{ isRtl ? 'الحضور' : 'Attendance' }}</a>
        <a routerLink="/students/evaluations" class="rounded-full bg-transparent border border-white/30 text-white hover:bg-white/10 px-4 py-2">{{ isRtl ? 'التقييمات' : 'Evaluations' }}</a>
      </div>
    </div>

    <div class="bg-white/10 backdrop-blur-sm border border-white/20 rounded-2xl p-4 sm:p-6 mb-6">
      <div class="relative">
        <input
          [placeholder]="isRtl ? 'ابحث باسم الطالب أو البريد...' : 'Search by name or email...'"
          [(ngModel)]="query"
          (keydown.enter)="onSearch()"
          class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/30"
          [dir]="isRtl ? 'rtl' : 'ltr'"
        />
      </div>
    </div>

    <div class="bg-white/10 backdrop-blur-sm border border-white/20 rounded-2xl p-4 sm:p-6">
      <div *ngIf="loading" class="text-center text-white/90 py-16">{{ isRtl ? 'جاري التحميل...' : 'Loading...' }}</div>
      <div *ngIf="!loading && filteredStudents.length === 0" class="text-center text-white/80 py-16">{{ isRtl ? 'لا يوجد طلاب' : 'No students found' }}</div>

      <div *ngIf="!loading && filteredStudents.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div *ngFor="let s of pagedStudents" class="p-6 rounded-xl bg-gradient-to-br from-white/10 to-white/5 border border-white/20 hover:border-white/30 transition-all duration-300 hover:shadow-lg hover:shadow-white/10">
          <div class="flex items-start justify-between gap-4" [ngClass]="isRtl ? 'flex-row-reverse' : ''">
            <div class="flex-shrink-0">
              <div class="w-16 h-16 rounded-full bg-gradient-to-br from-white/20 to-white/5 border border-white/30 overflow-hidden flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105">
                <img *ngIf="getImageUrl(s)" [src]="getImageUrl(s)" [alt]="getName(s)" class="w-full h-full object-cover" />
                <div *ngIf="!getImageUrl(s)" class="w-full h-full flex items-center justify-center">
                  <svg class="h-8 w-8 text-white/60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H7a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
                </div>
              </div>
            </div>

            <div class="flex-1 min-w-0" [ngClass]="isRtl ? 'text-right' : 'text-left'">
              <div class="text-white font-semibold text-lg mb-1 truncate">{{ getName(s) }}</div>
              <div *ngIf="getEmail(s)" class="text-white/80 text-sm truncate mb-1">{{ getEmail(s) }}</div>
              <div *ngIf="getPhone(s)" class="text-white/60 text-sm truncate">{{ getPhone(s) }}</div>
            </div>

            <div class="flex flex-col items-end gap-2">
              <div class="inline-flex px-3 py-1 rounded-full text-xs font-medium" [ngClass]="isActive(s) ? 'bg-green-500/20 text-green-300 border border-green-500/30' : 'bg-yellow-500/20 text-yellow-200 border border-yellow-500/30'">
                {{ isActive(s) ? (isRtl ? 'نشط' : 'Active') : (isRtl ? 'غير نشط' : 'Inactive') }}
              </div>
              <div class="flex items-center gap-2" *ngIf="isAdmin">
                <button class="text-blue-400 hover:text-blue-300 hover:bg-blue-500/20 p-1 h-8 w-8 rounded-full transition-all" [routerLink]="['/students/data']" [queryParams]="{ id: s.id, view: true }" title="{{ isRtl ? 'عرض' : 'View' }}">
                  <svg class="h-3 w-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/></svg>
                </button>
                <button class="text-yellow-300 hover:text-yellow-200 hover:bg-yellow-500/20 p-1 h-8 w-8 rounded-full transition-all" (click)="showEditStudentForm(s)" title="{{ isRtl ? 'تعديل' : 'Edit' }}">
                  <svg class="h-3 w-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 1 1 3 3L7 19l-4 1 1-4Z"/></svg>
                </button>
                <button class="text-red-400 hover:text-red-300 hover:bg-red-500/20 p-1 h-8 w-8 rounded-full transition-all" (click)="deleteStudent(s)" title="{{ isRtl ? 'حذف' : 'Delete' }}">
                  <svg class="h-3 w-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"/></svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  <!-- Pagination Controls -->
  <div class="container" *ngIf="!loading && !error && total > pageSize" style="display:flex;gap:8px;justify-content:center;align-items:center;margin:16px 0;">
    <button (click)="prevPage()" [disabled]="page<=1">{{ 'prev' | t }}</button>
    <span>{{ ('page_of' | t).replace('{{page}}', page) .replace('{{total}}', totalPages) }}</span>
    <button (click)="nextPage()" [disabled]="page>=totalPages">{{ 'next' | t }}</button>
  </div>

  <!-- Add New Student Modal -->
  <div class="modal-overlay" *ngIf="showAddForm" (click)="cancelForm()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ 'add_student_modal_title' | t }}</h3>
        <button class="close-btn" (click)="cancelForm()">×</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="addStudent()">
          <div class="form-row">
            <div class="form-group">
              <label for="firstName">{{ 'first_name' | t }}</label>
              <input type="text" id="firstName" [(ngModel)]="newStudent.firstName" name="firstName" required>
            </div>
            <div class="form-group">
              <label for="lastName">{{ 'last_name' | t }}</label>
              <input type="text" id="lastName" [(ngModel)]="newStudent.lastName" name="lastName" required>
            </div>
          </div>
          
          <div class="form-group">
            <label for="email">{{ 'email' | t }}</label>
            <input type="email" id="email" [(ngModel)]="newStudent.email" name="email" required>
          </div>
          
          <div class="form-group">
            <label for="phone">{{ 'phone' | t }}</label>
            <input type="tel" id="phone" [(ngModel)]="newStudent.phone" name="phone">
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="academyId">{{ 'academy' | t }}</label>
              <select id="academyId" [(ngModel)]="newStudent.academyId" name="academyId" required>
                <option value="">{{ 'choose_academy' | t }}</option>
                <option *ngFor="let academy of academies" [value]="academy.id || academy.Id">
                  {{ getAcademyName(academy.id || academy.Id) }}
                </option>
              </select>
            </div>
            <div class="form-group">
              <label for="branchId">{{ 'branch' | t }}</label>
              <select id="branchId" [(ngModel)]="newStudent.branchId" name="branchId" required>
                <option value="">{{ 'choose_branch' | t }}</option>
                <option *ngFor="let branch of branches" [value]="branch.id || branch.Id">
                  {{ getBranchName(branch.id || branch.Id) }}
                </option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label for="status">{{ 'status' | t }}</label>
            <select id="status" [(ngModel)]="newStudent.status" name="status" required>
              <option value="نشط">{{ 'active' | t }}</option>
              <option value="غير نشط">{{ 'inactive' | t }}</option>
              <option value="معلق">{{ 'suspended' | t }}</option>
            </select>
          </div>
          
          <div class="form-actions">
            <button type="button" class="cancel-btn" (click)="cancelForm()">{{ 'cancel_btn' | t }}</button>
            <button type="submit" class="submit-btn" [disabled]="loading">{{ 'submit_add_student' | t }}</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Student Modal -->
  <div class="modal-overlay" *ngIf="showEditForm" (click)="cancelForm()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ 'edit_student_title' | t }}</h3>
        <button class="close-btn" (click)="cancelForm()">×</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="updateStudent()">
          <div class="form-row">
            <div class="form-group">
              <label for="edit-firstName">{{ 'first_name' | t }}</label>
              <input type="text" id="edit-firstName" [(ngModel)]="newStudent.firstName" name="edit-firstName" required>
            </div>
            <div class="form-group">
              <label for="edit-lastName">{{ 'last_name' | t }}</label>
              <input type="text" id="edit-lastName" [(ngModel)]="newStudent.lastName" name="edit-lastName" required>
            </div>
          </div>
          
          <div class="form-group">
            <label for="edit-email">{{ 'email' | t }}</label>
            <input type="email" id="edit-email" [(ngModel)]="newStudent.email" name="edit-email" required>
          </div>
          
          <div class="form-group">
            <label for="edit-phone">{{ 'phone' | t }}</label>
            <input type="tel" id="edit-phone" [(ngModel)]="newStudent.phone" name="edit-phone">
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-academyId">{{ 'academy' | t }}</label>
              <select id="edit-academyId" [(ngModel)]="newStudent.academyId" name="edit-academyId" required>
                <option value="">{{ 'choose_academy' | t }}</option>
                <option *ngFor="let academy of academies" [value]="academy.id || academy.Id">
                  {{ getAcademyName(academy.id || academy.Id) }}
                </option>
              </select>
            </div>
            <div class="form-group">
              <label for="edit-branchId">{{ 'branch' | t }}</label>
              <select id="edit-branchId" [(ngModel)]="newStudent.branchId" name="edit-branchId" required>
                <option value="">{{ 'choose_branch' | t }}</option>
                <option *ngFor="let branch of branches" [value]="branch.id || branch.Id">
                  {{ getBranchName(branch.id || branch.Id) }}
                </option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label for="edit-status">{{ 'status' | t }}</label>
            <select id="edit-status" [(ngModel)]="newStudent.status" name="edit-status" required>
              <option value="نشط">{{ 'active' | t }}</option>
              <option value="غير نشط">{{ 'inactive' | t }}</option>
              <option value="معلق">{{ 'suspended' | t }}</option>
            </select>
          </div>
          
          <div class="form-actions">
            <button type="button" class="cancel-btn" (click)="cancelForm()">{{ 'cancel_btn' | t }}</button>
            <button type="submit" class="submit-btn" [disabled]="loading">{{ 'save_changes_btn' | t }}</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

