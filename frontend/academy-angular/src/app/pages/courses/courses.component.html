<section class="relative isolate overflow-hidden">
  <div class="absolute inset-0 -z-10 animated-gradient opacity-90"></div>
  <div class="absolute inset-0 z-0 bg-black/55"></div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-14 md:py-20 lg:py-28 relative z-10" dir="rtl">
    <div class="flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between mb-6">
      <h1 class="text-3xl sm:text-4xl font-extrabold text-white">
        {{ 'catalog_title' | t : 'الكاتالوج' }}
      </h1>
      <div class="flex items-center gap-2">
        <a routerLink="/sessions" class="academy-button rounded-full">
          {{ 'session_calendar' | t : 'تقويم الجلسات' }}
        </a>
      </div>
    </div>

    <div class="glass p-4 sm:p-6 mb-6">
      <div class="relative">
        <input
          type="text"
          [placeholder]="('search_catalog' | t) || 'ابحث في الكاتالوج...'"
          [(ngModel)]="query"
          (keydown.enter)="onSearch()"
          class="search-input"
          dir="rtl"
        />
        <button type="button" class="clear-btn" *ngIf="query" (click)="query=''; onSearch()">×</button>
      </div>
    </div>

    <div class="glass p-4 sm:p-6">
      <div class="tabs-list">
        <button class="tab" [class.active]="activeTab==='projectMasters'" (click)="activeTab='projectMasters'">
          Project Master <span *ngIf="debouncedQuery">({{ pmCount }})</span>
        </button>
        <button class="tab" [class.active]="activeTab==='projectDetails'" (click)="activeTab='projectDetails'">
          Project Details <span *ngIf="debouncedQuery">({{ pdCount }})</span>
        </button>
        <button class="tab" [class.active]="activeTab==='programDetails'" (click)="activeTab='programDetails'">
          Program Details <span *ngIf="debouncedQuery">({{ prCount }})</span>
        </button>
      </div>

      <div class="mt-6" *ngIf="activeTab==='projectMasters'">
        <div *ngIf="loading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="skeleton-card animate-pulse" *ngFor="let i of [0,1,2,3,4,5]"></div>
        </div>
        <div *ngIf="!loading && filteredProjectMasters.length === 0" class="text-center text-white/80 py-16">
          {{ 'no_project_masters' | t : 'لا توجد مشاريع' }}
        </div>
        <div *ngIf="!loading && filteredProjectMasters.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="catalog-card hoverable" *ngFor="let pm of filteredProjectMasters">
            <div class="media with-gradient"></div>
            <div class="flex items-start justify-between gap-3">
              <div class="flex-1">
                <div class="card-title">{{ pm.projectNameL1 || pm.ProjectNameL1 || 'Project' }}</div>
                <div class="card-subtitle">{{ pm.description || pm.Description }}</div>
              </div>
            </div>
            <div class="mt-4 flex items-center justify-end">
              <a [routerLink]="['/project-details', pm.id || pm.Id]" class="btn-xs inline-flex items-center gap-1">
                {{ 'view_details' | t : 'عرض التفاصيل' }}
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-6" *ngIf="activeTab==='projectDetails'">
        <div *ngIf="loading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="skeleton-card animate-pulse" *ngFor="let i of [0,1,2,3,4,5]"></div>
        </div>
        <div *ngIf="!loading && filteredProjectDetails.length === 0" class="text-center text-white/80 py-16">
          {{ 'no_project_details' | t : 'لا توجد تفاصيل مشاريع' }}
        </div>
        <div *ngIf="!loading && filteredProjectDetails.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="catalog-card hoverable" *ngFor="let pd of filteredProjectDetails">
            <div class="media with-gradient"></div>
            <div class="flex items-start justify-between gap-3">
              <div class="flex-1">
                <div class="card-title">{{ pd.projectNameL1 || pd.ProjectNameL1 || 'Project Detail' }}</div>
                <div class="card-subtitle">{{ pd.description || pd.Description }}</div>
              </div>
            </div>
            <div class="mt-4 flex items-center justify-end">
              <a [routerLink]="['/project-details', pd.ProjectsMasterId || pd.projectsMasterId || pd.id]" class="btn-xs inline-flex items-center gap-1">
                {{ 'view_details' | t : 'عرض التفاصيل' }}
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-6" *ngIf="activeTab==='programDetails'">
        <div *ngIf="loading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="skeleton-card animate-pulse" *ngFor="let i of [0,1,2,3,4,5]"></div>
        </div>
        <div *ngIf="!loading && filteredProgramDetails.length === 0" class="text-center text-white/80 py-16">
          {{ 'no_program_details' | t : 'لا توجد تفاصيل برامج' }}
        </div>
        <div *ngIf="!loading && filteredProgramDetails.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="catalog-card hoverable" *ngFor="let pr of filteredProgramDetails">
            <div class="media with-gradient"></div>
            <div class="flex items-start justify-between gap-3">
              <div class="flex-1">
                <div class="card-title">{{ pr.SessionNameL1 || pr.sessionNameL1 || 'Program' }}</div>
                <div class="card-subtitle">{{ pr.Description || pr.description }}</div>
              </div>
            </div>
            <div class="mt-4 flex items-center justify-end">
              <a [routerLink]="['/program-details', pr.id || pr.Id]" class="btn-xs inline-flex items-center gap-1">
                {{ 'view_details' | t : 'عرض التفاصيل' }}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
