<section class="relative isolate overflow-hidden" dir="rtl">
  <div class="absolute inset-0 -z-10 animated-gradient opacity-90"></div>
  <div class="absolute inset-0 z-0 bg-black/55"></div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-14 md:py-20 lg:py-28 relative z-10">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl sm:text-4xl font-extrabold text-white">Project Details</h1>
      <button *ngIf="isAdmin" class="academy-button rounded-full" (click)="openCreateForm()">إضافة تفاصيل مشروع</button>
    </div>

    <div *ngIf="usingDefaultData" class="mb-4 p-3 bg-yellow-500/20 border border-yellow-500/30 rounded-lg text-white">
      ⚠️ عرض بيانات افتراضية - لا توجد بيانات متاحة من الخادم
    </div>

    <div *ngIf="loading" class="text-center text-white py-10">
      <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"></div>
      جاري التحميل...
    </div>
    <div *ngIf="error && !loading" class="text-center text-white py-10">
      {{ error }}
    </div>

    <div class="bg-white/10 backdrop-blur-sm border border-white/20 rounded-2xl p-4 sm:p-6" *ngIf="!loading">
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-white projects-table">
          <thead>
            <tr class="text-right text-white/80">
              <th class="p-2">المشروع الرئيسي</th>
              <th class="p-2">الاسم (ع)</th>
              <th class="p-2">الاسم (EN)</th>
              <th class="p-2">الوصف</th>
              <th class="p-2">الإجراءات</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let r of rows" class="border-t border-white/10">
              <td class="p-2">{{ getMasterName(r.ProjectsMasterId || r.projectsMasterId) }}</td>
              <td class="p-2">{{ r.projectNameL1 || r.ProjectNameL1 }}</td>
              <td class="p-2">{{ r.projectNameL2 || r.ProjectNameL2 }}</td>
              <td class="p-2 description-cell">{{ r.description || r.Description }}</td>
              <td class="p-2 actions-cell">
                <div class="flex gap-2 actions-group">
                  <button class="btn-xs bg-green-600 hover:bg-green-700 text-white" [routerLink]="['/projects', (r.projectsMasterId || r.ProjectsMasterId || r.id || r.Id)]">عرض</button>
                  <ng-container *ngIf="isAdmin">
                    <button class="btn-xs" (click)="openEditForm(r)">تعديل</button>
                    <button class="btn-xs" (click)="delete(r)">حذف</button>
                  </ng-container>
                </div>
              </td>
            </tr>
            <tr *ngIf="rows.length === 0">
              <td class="p-4 text-center text-white/70" colspan="5">لا توجد تفاصيل.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Modal Form -->
    <div class="modal-overlay" *ngIf="isFormOpen" (click)="closeForm()">
      <div class="modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ selectedRow ? 'تعديل تفاصيل المشروع' : 'إضافة تفاصيل مشروع' }}</h3>
          <button class="close-btn" (click)="closeForm()">×</button>
        </div>
        <div class="modal-body">
          <form (ngSubmit)="save()">
            <div class="form-group">
              <label for="ProjectsMasterId">المشروع الرئيسي *</label>
              <select id="ProjectsMasterId" [(ngModel)]="formModel.ProjectsMasterId" name="ProjectsMasterId" required>
                <option value="">اختر المشروع الرئيسي</option>
                <option *ngFor="let m of projectsMaster" [value]="m.id || m.Id">
                  {{ m.ProjectNameL1 || m.projectNameL1 || m.ProjectNameL2 || m.projectNameL2 || m.name || (m.id || m.Id) }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label for="ProjectNameL1">اسم المشروع (عربي) *</label>
              <input id="ProjectNameL1" [(ngModel)]="formModel.ProjectNameL1" name="ProjectNameL1" required minlength="3" maxlength="70" />
            </div>

            <div class="form-group">
              <label for="ProjectNameL2">اسم المشروع (إنجليزي)</label>
              <input id="ProjectNameL2" [(ngModel)]="formModel.ProjectNameL2" name="ProjectNameL2" maxlength="70" />
            </div>

            <div class="form-group">
              <label for="Description">الوصف</label>
              <textarea id="Description" [(ngModel)]="formModel.Description" name="Description" rows="4" maxlength="500"></textarea>
            </div>

            <div class="form-actions">
              <button type="button" class="cancel-btn" (click)="closeForm()">إلغاء</button>
              <button type="submit" class="submit-btn" [disabled]="isSubmitting">{{ isSubmitting ? 'جاري الحفظ...' : 'حفظ' }}</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

